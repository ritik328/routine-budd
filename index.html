<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Routine Buddy</title>
    
    <!-- PWA / Mobile Meta Tags -->
    <meta name="theme-color" id="meta-theme-color" content="#fdf2f8">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Routine Buddy">
    <link rel="apple-touch-icon" href="https://fonts.gstatic.com/s/i/shortterm/release/googlestyleshelf/emoji/v1/48px/1f338.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        darkBg: '#0f172a',
                        darkCard: '#1e293b',
                    }
                }
            }
        }
    </script>
    <style>
        :root {
            --vibe-color: rgb(255, 91, 137); /* Default Pink */
            --vibe-light: #fdf2f8;
            --accent-green: #dcfce7;
            --accent-green-dark: #22c55e;
            --text-main: #334155;
        }

        body {
            font-family: 'Quicksand', sans-serif;
            transition: background-color 0.4s ease, color 0.4s ease;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            overflow-x: hidden;
        }

        /* --- Heart Checkbox Styling --- */
        .heart-container {
            position: relative;
            width: 40px;
            height: 40px;
            transition: .3s;
            flex-shrink: 0;
        }

        .heart-container .checkbox {
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0;
            z-index: 20;
            cursor: pointer;
        }

        .heart-container .svg-container {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .heart-container .svg-outline,
        .heart-container .svg-filled {
            fill: var(--vibe-color);
            position: absolute;
            width: 28px;
            height: 28px;
        }

        .dark .heart-container .svg-outline {
            fill: #475569;
        }
        .heart-container .checkbox:checked ~ .svg-container .svg-outline {
            display: none;
        }

        .heart-container .svg-filled {
            animation: keyframes-svg-filled 1s;
            display: none;
        }

        .heart-container .svg-celebrate {
            position: absolute;
            animation: keyframes-svg-celebrate .5s;
            animation-fill-mode: forwards;
            display: none;
            stroke: var(--vibe-color);
            fill: var(--vibe-color);
            stroke-width: 2px;
        }

        .heart-container .checkbox:checked ~ .svg-container .svg-filled {
            display: block;
            fill: var(--vibe-color);
        }

        .heart-container .checkbox:checked ~ .svg-container .svg-celebrate {
            display: block;
        }

        @keyframes keyframes-svg-filled {
            0% { transform: scale(0); }
            25% { transform: scale(1.2); }
            50% { transform: scale(1); filter: brightness(1.5); }
        }

        @keyframes keyframes-svg-celebrate {
            0% { transform: scale(0); }
            50% { opacity: 1; filter: brightness(1.5); }
            100% { transform: scale(1.4); opacity: 0; display: none; }
        }

        /* --- Dynamic Vibe Colors --- */
        .vibe-bg { background-color: var(--vibe-color); }
        .vibe-text { color: var(--vibe-color); }
        .vibe-border { border-color: var(--vibe-color); }
        .vibe-soft-bg { background-color: var(--vibe-light); }

        /* Card Styling */
        .task-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .task-card:active:not(.read-only) {
            transform: scale(0.96);
        }
        .completed-card {
            background-color: var(--accent-green) !important;
            border-color: #bbf7d0 !important;
        }
        .dark .completed-card {
            background-color: #064e3b !important;
            border-color: #065f46 !important;
        }

        /* Progress Ring */
        .progress-ring__circle {
            transition: stroke-dashoffset 0.5s ease-in-out;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        }

        #sidebar { transition: transform 0.3s ease-in-out; z-index: 100; }
        #sidebar.closed { transform: translateX(-100%); }
        #sidebar-overlay { transition: opacity 0.3s ease-in-out; z-index: 90; }

        .pipe-bar { transition: height 1s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        
        /* Floating Toasts */
        .floating-message { animation: floatUp 2s forwards; pointer-events: none; }
        @keyframes floatUp {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-50px); opacity: 0; }
        }

        .droplet { transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .droplet:active { transform: scale(1.3); }

        ::-webkit-scrollbar { display: none; }

        .theme-toggle {
            position: relative;
            width: 60px;
            height: 32px;
            border-radius: 30px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .toggle-knob {
            position: absolute;
            top: 4px;
            left: 4px;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background-color: white;
            transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .dark .theme-toggle { background-color: #475569; }
        .light .theme-toggle { background-color: #f1f5f9; border: 1px solid #e2e8f0; }
        .dark .toggle-knob { transform: translateX(28px); background-color: #1e293b; }

        /* Vibe Selector Styles */
        .vibe-dot {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid transparent;
            transition: transform 0.2s;
        }
        .vibe-dot:active { transform: scale(0.9); }
        .vibe-dot.active { border-color: white; box-shadow: 0 0 0 2px #cbd5e1; }

        /* Quick Notes Modal Styling */
        #notes-modal {
            z-index: 150;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .modal-hidden {
            transform: translateY(100%);
            opacity: 0;
            pointer-events: none;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-700 dark:bg-darkBg dark:text-slate-100 min-h-screen pb-40">

    <!-- Sidebar Overlay -->
    <div id="sidebar-overlay" class="fixed inset-0 bg-slate-900/40 backdrop-blur-sm hidden" onclick="toggleSidebar()"></div>

    <!-- Quick Notes Modal -->
    <div id="notes-modal" class="fixed inset-0 flex flex-col justify-end modal-hidden">
        <div class="bg-black/20 backdrop-blur-sm absolute inset-0" onclick="toggleNotes()"></div>
        <div class="bg-white dark:bg-darkCard rounded-t-[40px] p-8 pb-12 relative shadow-2xl max-h-[85vh] flex flex-col">
            <div class="w-12 h-1.5 bg-slate-200 dark:bg-slate-700 rounded-full mx-auto mb-6"></div>
            
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold vibe-text">Quick Notes ‚ú®</h3>
                <button onclick="toggleNotes()" class="p-2 bg-slate-100 dark:bg-slate-800 rounded-full">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>

            <div class="flex gap-2 mb-6">
                <input id="note-input" type="text" placeholder="Write something important..." class="flex-grow bg-slate-50 dark:bg-slate-900 p-4 rounded-2xl outline-none font-medium border-2 border-transparent focus:border-slate-200 dark:focus:border-slate-700 transition-all text-sm">
                <button onclick="addNote()" class="vibe-bg p-4 rounded-2xl text-white shadow-lg active:scale-90 transition-transform">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                </button>
            </div>

            <div id="notes-list" class="space-y-3 overflow-y-auto flex-grow pb-4">
                <!-- Notes will be injected here -->
            </div>
            
            <p class="text-[10px] text-slate-400 text-center mt-4">These stay saved until you delete them! üíñ</p>
        </div>
    </div>

    <!-- Sidebar -->
    <aside id="sidebar" class="fixed top-0 left-0 bottom-0 w-64 bg-pink-50 dark:bg-slate-800 shadow-2xl p-6 closed border-r dark:border-slate-700">
        <div class="flex items-center gap-2 mb-8 mt-4">
            <span class="text-2xl">üå∏</span>
            <h2 id="sidebar-name" class="font-bold text-xl vibe-text">Buddy</h2>
        </div>
        
        <nav class="space-y-2">
            <button onclick="switchTab('today')" class="w-full flex items-center gap-3 p-4 rounded-2xl bg-white dark:bg-slate-700 text-slate-700 dark:text-slate-200 font-bold shadow-sm border border-slate-100 dark:border-slate-600 transition-all active:scale-95">
                <span>üìÖ</span> Today
            </button>
            <button onclick="switchTab('demo')" class="w-full flex items-center gap-3 p-4 rounded-2xl bg-white dark:bg-slate-700 text-slate-700 dark:text-slate-200 font-bold shadow-sm border border-slate-100 dark:border-slate-600 transition-all active:scale-95">
                <span>‚≠ê</span> Demo Mode
            </button>
            <button onclick="switchTab('milestones')" class="w-full flex items-center gap-3 p-4 rounded-2xl bg-white dark:bg-slate-700 text-slate-700 dark:text-slate-200 font-bold shadow-sm border border-slate-100 dark:border-slate-600 transition-all active:scale-95">
                <span>üèÖ</span> Milestones
            </button>
            <button onclick="switchTab('settings')" class="w-full flex items-center gap-3 p-4 rounded-2xl bg-white dark:bg-slate-700 text-slate-700 dark:text-slate-200 font-bold shadow-sm border border-slate-100 dark:border-slate-600 transition-all active:scale-95">
                <span>‚öôÔ∏è</span> Settings
            </button>
            
            <button id="install-btn" class="hidden w-full flex items-center gap-3 p-4 rounded-2xl vibe-bg text-white font-bold shadow-md transition-all active:scale-95">
                <span>üì≤</span> Install App
            </button>

            <button onclick="switchTab('about')" class="w-full flex items-center gap-3 p-4 rounded-2xl bg-white dark:bg-slate-700 text-slate-700 dark:text-slate-200 font-bold shadow-sm border border-slate-100 dark:border-slate-600 transition-all active:scale-95">
                <span>üíñ</span> Share App
            </button>
        </nav>

        <div class="absolute bottom-10 left-6 right-6 text-center">
            <p class="text-[10px] text-slate-400 dark:text-slate-500 font-bold uppercase tracking-widest">Version 2.0.0</p>
        </div>
    </aside>

    <!-- Navigation -->
    <nav class="p-4 flex items-center justify-between sticky top-0 bg-white/70 dark:bg-darkBg/70 backdrop-blur-md z-30 transition-colors">
        <div class="flex items-center gap-4">
            <button onclick="toggleSidebar()" class="p-3 bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-100 dark:border-slate-700 active:scale-90 transition-transform">
                <svg class="w-6 h-6 text-slate-600 dark:text-slate-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
            </button>
            <div id="demo-badge" class="hidden px-4 py-2 bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-400 rounded-full text-[10px] font-bold border border-yellow-200 dark:border-yellow-800 animate-pulse">
                üéÄ DEMO MODE
            </div>
        </div>

        <div class="theme-toggle" onclick="toggleTheme()" id="theme-toggle">
            <div class="toggle-knob" id="toggle-knob">üåû</div>
        </div>
    </nav>

    <!-- Today View -->
    <div id="view-today">
        <header class="px-6 pt-4 pb-4">
            <!-- Sunday Summary Header (Conditional) -->
            <div id="sunday-summary" class="hidden mb-6 p-5 bg-gradient-to-br from-yellow-50 to-orange-50 dark:from-yellow-900/20 dark:to-orange-900/20 rounded-3xl border border-yellow-100 dark:border-yellow-800/40 shadow-sm transition-all animate-pulse">
                <div class="flex items-center gap-3">
                    <span class="text-3xl">üíê</span>
                    <div>
                        <h4 class="text-sm font-bold text-orange-800 dark:text-orange-300">Sunday Weekly Bloom!</h4>
                        <p id="bloom-score-text" class="text-xs text-orange-600 dark:text-orange-400">Loading Disha's week...</p>
                    </div>
                </div>
            </div>

            <div class="flex justify-between items-start">
                <div class="relative">
                    <h1 id="greeting" class="text-2xl font-bold text-slate-800 dark:text-slate-100 leading-tight">Good Morning!</h1>
                    <p id="current-date" class="text-xs text-slate-500 dark:text-slate-400 font-medium mt-0.5">Today is ...</p>
                    
                    <!-- Buddy Message Bubble -->
                    <div id="buddy-bubble" class="mt-3 flex items-center gap-2 p-2 px-3 bg-white dark:bg-slate-800 rounded-2xl rounded-tl-none border border-slate-100 dark:border-slate-700 shadow-sm w-fit transition-all duration-500 transform translate-y-0 opacity-100">
                        <span class="text-xs font-semibold vibe-text" id="buddy-text">You got this! ‚ú®</span>
                    </div>
                </div>
                
                <div class="flex flex-col items-end gap-2">
                    <span id="streak-badge" class="px-3 py-1 bg-orange-100 dark:bg-orange-900/30 text-orange-600 dark:text-orange-400 rounded-full text-xs font-bold shadow-sm">0 Days üî•</span>
                    
                    <!-- Quick Todo Button -->
                    <button onclick="toggleNotes()" class="relative px-3 py-1.5 bg-white dark:bg-slate-800 border border-slate-100 dark:border-slate-700 text-slate-600 dark:text-slate-300 rounded-full text-xs font-bold shadow-sm active:scale-95 transition-all flex items-center gap-1.5">
                        Notes üìù
                        <span id="notes-count-badge" class="hidden absolute -top-1 -right-1 w-2.5 h-2.5 vibe-bg rounded-full border border-white dark:border-slate-900"></span>
                    </button>
                </div>
            </div>
            
            <div class="mt-6 flex flex-col gap-2">
                <div class="flex justify-between items-center text-[10px] font-bold text-slate-400 uppercase tracking-widest">
                    <span>Hydration Goal</span>
                    <span id="water-count">0/8 Cups</span>
                </div>
                <div class="flex justify-between gap-1" id="water-droplets"></div>
            </div>

            <div class="mt-6 p-4 bg-white dark:bg-darkCard rounded-2xl border border-slate-100 dark:border-slate-800 shadow-sm transition-colors">
                <p id="daily-quote" class="text-sm font-medium vibe-text italic leading-snug">
                    "Small steps lead to big dreams. ‚ú®"
                </p>
            </div>
        </header>

        <main class="px-6 space-y-4" id="task-container"></main>

        <div class="px-6 mt-10">
            <div class="p-5 bg-purple-50 dark:bg-purple-900/20 rounded-3xl border border-purple-100 dark:border-purple-800">
                <h4 class="text-sm font-bold text-purple-700 dark:text-purple-400 flex items-center gap-2 mb-3">
                    ‚úçÔ∏è One Good Thing...
                </h4>
                <textarea id="journal-input" placeholder="What made you smile today?" oninput="saveJournal()" class="w-full bg-white/50 dark:bg-slate-900/50 p-4 rounded-2xl text-sm text-slate-700 dark:text-slate-200 outline-none border-2 border-transparent focus:border-purple-200 transition-all resize-none h-24" maxlength="200"></textarea>
                <p class="text-[10px] text-purple-400 mt-2 italic text-right">It clears every morning, just for you! ‚ú®</p>
            </div>
        </div>

        <div id="perfect-day-reward" class="hidden px-6 mt-8 text-center animate-bounce">
            <div class="bg-yellow-100 dark:bg-yellow-900/20 rounded-3xl p-6 border-2 border-yellow-200 dark:border-yellow-800">
                <span class="text-6xl block mb-2">üëë</span>
                <h2 id="reward-title" class="text-xl font-bold text-yellow-800 dark:text-yellow-400">Routine Queen!</h2>
                <p id="reward-text" class="text-yellow-700 dark:text-yellow-500 text-sm">You've conquered the day!</p>
            </div>
        </div>

        <section class="mt-12 px-6 pb-12 border-t border-slate-100 dark:border-slate-800 pt-8">
            <div class="flex justify-between items-center mb-6">
                <h3 id="stats-title" class="text-xl font-bold text-slate-700 dark:text-slate-200 flex items-center gap-2">
                    üå∏ Stats
                </h3>
                <div class="flex bg-slate-100 dark:bg-slate-800 p-1 rounded-xl">
                    <button id="btn-week" onclick="setChartRange('week')" class="px-3 py-1.5 text-[10px] font-bold uppercase rounded-lg transition-all">Week</button>
                    <button id="btn-month" onclick="setChartRange('month')" class="px-3 py-1.5 text-[10px] font-bold uppercase rounded-lg transition-all">Month</button>
                </div>
            </div>
            
            <div class="bg-white dark:bg-darkCard p-6 rounded-3xl shadow-sm border border-slate-50 dark:border-slate-800 mb-4 transition-colors overflow-hidden">
                <div id="chart-container" class="flex items-end justify-between h-48 gap-2 overflow-x-auto pb-4 scroll-smooth"></div>
            </div>
        </section>
    </div>

    <!-- Settings View -->
    <div id="view-settings" class="hidden px-6 pt-8 pb-32">
        <h2 class="text-2xl font-bold text-slate-800 dark:text-slate-100 mb-6">Settings ‚öôÔ∏è</h2>
        
        <div class="space-y-8">
            <div class="bg-white dark:bg-darkCard p-6 rounded-3xl shadow-sm border border-slate-100 dark:border-slate-800">
                <label class="block text-xs font-bold text-slate-400 uppercase mb-3">Your Name</label>
                <input id="setting-name" type="text" oninput="updateUserNameSetting()" placeholder="Enter your name..." class="w-full bg-slate-50 dark:bg-slate-900 p-4 rounded-2xl outline-none vibe-text font-bold border-2 border-transparent focus:border-slate-200 transition-all">
            </div>

            <div class="bg-white dark:bg-darkCard p-6 rounded-3xl shadow-sm border border-slate-100 dark:border-slate-800">
                <label class="block text-xs font-bold text-slate-400 uppercase mb-4">Choose Your Vibe</label>
                <div class="flex justify-between" id="vibe-selector">
                    <div onclick="changeVibe('pink', '#f472b6')" class="vibe-dot bg-[#f472b6]" data-vibe="pink"></div>
                    <div onclick="changeVibe('lavender', '#a78bfa')" class="vibe-dot bg-[#a78bfa]" data-vibe="lavender"></div>
                    <div onclick="changeVibe('mint', '#34d399')" class="vibe-dot bg-[#34d399]" data-vibe="mint"></div>
                    <div onclick="changeVibe('sky', '#38bdf8')" class="vibe-dot bg-[#38bdf8]" data-vibe="sky"></div>
                    <div onclick="changeVibe('peach', '#fb923c')" class="vibe-dot bg-[#fb923c]" data-vibe="peach"></div>
                </div>
            </div>

            <p class="text-center text-[10px] text-slate-400 font-medium px-10 italic">Changing these will make the app feel uniquely yours! ‚ú®</p>
        </div>
    </div>

    <!-- Milestones View -->
    <div id="view-milestones" class="hidden px-6 pt-8 pb-32">
        <h2 id="milestones-title" class="text-2xl font-bold text-slate-800 dark:text-slate-100 mb-2">Stickers üèÖ</h2>
        <p class="text-sm text-slate-500 mb-8">Collect trophies for staying consistent!</p>
        <div class="grid grid-cols-2 gap-4" id="milestone-grid"></div>
    </div>

    <!-- About Section -->
    <div id="view-about" class="hidden px-6 pt-10">
        <div class="text-center">
            <span class="text-7xl">üíñ</span>
            <h1 class="text-3xl font-bold text-slate-800 dark:text-slate-100 mt-6">Share App</h1>
            <p id="about-text" class="text-slate-500 dark:text-slate-400 mt-4 leading-relaxed px-4">
                Tell your besties about the Routine Buddy! üå∏
            </p>
            <div class="mt-12 space-y-4 px-4">
                <button onclick="copyAppShare()" class="w-full vibe-bg text-white p-5 rounded-3xl font-bold shadow-lg active:scale-95 transition-all flex items-center justify-center gap-3">
                    üîó Copy Share Link
                </button>
            </div>
        </div>
    </div>

    <footer id="bottom-bar" class="fixed bottom-0 left-0 right-0 bg-white/90 dark:bg-slate-900/90 backdrop-blur-md border-t border-slate-100 dark:border-slate-800 p-5 px-8 flex flex-col items-center shadow-lg z-40 transition-colors">
        <div class="w-full bg-slate-100 dark:bg-slate-800 h-2.5 rounded-full overflow-hidden mb-3">
            <div id="progress-bar" class="h-full vibe-bg transition-all duration-500 w-0"></div>
        </div>
        <div class="flex justify-between w-full items-center">
            <p id="progress-text" class="font-bold text-slate-700 dark:text-slate-300 text-xs">0 / 0 tasks</p>
            <p id="motivation-msg" class="text-[10px] text-slate-500 italic">Let's go! üöÄ</p>
        </div>
    </footer>

    <div id="toast-container" class="fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 pointer-events-none flex flex-col items-center z-50"></div>

    <script>
        // --- DATA & STATE ---
        let USER_NAME = localStorage.getItem('userName') || "Disha";
        let CURRENT_VIBE = localStorage.getItem('currentVibe') || "pink";
        let CURRENT_VIBE_HEX = localStorage.getItem('currentVibeHex') || "#f472b6";
        let quickNotes = JSON.parse(localStorage.getItem('quickNotes') || '[]');

        const tasks = [
            { id: 'wake', text: 'Wake Up', time: '6:30 AM', emoji: 'üåû' },
            { id: 'ready', text: 'Get Ready', time: '6:30 ‚Äì 7:30 AM', emoji: 'ü™•' },
            { id: 'college', text: 'College + Travel', time: '7:30 ‚Äì 2:00 PM', emoji: 'üéí' },
            { id: 'return', text: 'Return Home', time: '2:00 ‚Äì 3:20 PM', emoji: 'üö∂‚Äç‚ôÄÔ∏è' },
            { id: 'lunch', text: 'Lunch / Rest', time: '3:20 ‚Äì 4:00 PM', emoji: 'üçΩÔ∏è' },
            { id: 'tuition', text: 'Tuition', time: '4:00 ‚Äì 6:00 PM', emoji: '‚úèÔ∏è' },
            { id: 'study1', text: 'Self Study', time: '6:15 ‚Äì 7:30 PM', emoji: 'üß†' },
            { id: 'relax', text: 'Relax / Timepass', time: '7:30 ‚Äì 8:00 PM', emoji: 'üéß' },
            { id: 'dinner', text: 'Dinner Prep + Eat', time: '8:00 ‚Äì 9:00 PM', emoji: 'üç≥' },
            { id: 'study2', text: 'Study', time: '10:30 ‚Äì 11:30 PM', emoji: 'üìñ' },
            { id: 'sleep', text: 'Sleep', time: '12:00 AM', emoji: 'üò¥' }
        ];

        const buddyMessages = [
            "Take a break if you need it, {name}! ‚òï",
            "You're doing better than yesterday! ‚ú®",
            "Don't forget to smile! üòä",
            "Almost at the finish line! üèÜ",
            "{name}, you are blooming today! üå∏",
            "Stay hydrated and keep going! üíß",
            "I'm so proud of your consistency! üëë",
            "Make today uniquely yours! üåà"
        ];

        const motivationalQuotes = [
            `Nice! Keep going ${USER_NAME} üå∏`, "Well done! üí™", "You're doing great ‚ú®", "Keep it up! ü¶ã", "One step closer üåà", "Fantastic work! üåü"
        ];

        const meaningfulQuotes = [
            `Small steps lead to big dreams, ${USER_NAME}. ‚ú®`, "Be kind to yourself today. üå∏", `You are doing your best, ${USER_NAME}. üíñ`,
            "Today is a new chance to bloom. üåø", `Radiate positivity, ${USER_NAME}! üåû`, "Your progress is beautiful. ü¶ã",
            `Focus on the good, ${USER_NAME}. üåà`, "Every day is a fresh page. üìñ", `${USER_NAME}, you are so strong. üí™`,
            "Happiness is a habit. üòä", "Choose kindness today. üå∏"
        ];

        const milestones = [
            { id: 'first', text: 'First Day Done', emoji: 'üå±', req: 1 },
            { id: 'week', text: 'Weekly Bloom', emoji: 'üå∏', req: 7 },
            { id: 'biweek', text: 'Stardust Consistency', emoji: '‚ú®', req: 14 },
            { id: 'month', text: 'Routine Queen', emoji: 'üëë', req: 30 }
        ];

        let currentView = 'today';
        let chartRange = 'week';
        let isDemoMode = false;
        let completedIds = [];
        let waterCount = 0;
        let streak = 0;
        let demoCompletedIds = ['wake', 'ready', 'college', 'return', 'lunch']; 

        // --- QUICK NOTES LOGIC ---
        function toggleNotes() {
            const modal = document.getElementById('notes-modal');
            modal.classList.toggle('modal-hidden');
            if (!modal.classList.contains('modal-hidden')) {
                renderNotes();
            }
        }

        function addNote() {
            const input = document.getElementById('note-input');
            const text = input.value.trim();
            if (!text) return;
            
            const newNote = {
                id: Date.now(),
                text: text,
                done: false
            };
            
            quickNotes.unshift(newNote);
            localStorage.setItem('quickNotes', JSON.stringify(quickNotes));
            input.value = '';
            renderNotes();
            updateNotesBadge();
            playSparkleSound();
        }

        function toggleNoteState(id) {
            quickNotes = quickNotes.map(note => 
                note.id === id ? { ...note, done: !note.done } : note
            );
            localStorage.setItem('quickNotes', JSON.stringify(quickNotes));
            renderNotes();
            updateNotesBadge();
        }

        function deleteNote(id) {
            quickNotes = quickNotes.filter(note => note.id !== id);
            localStorage.setItem('quickNotes', JSON.stringify(quickNotes));
            renderNotes();
            updateNotesBadge();
        }

        function renderNotes() {
            const container = document.getElementById('notes-list');
            container.innerHTML = '';
            
            if (quickNotes.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-10">
                        <span class="text-4xl block mb-2">‚òÅÔ∏è</span>
                        <p class="text-slate-400 text-sm">No notes yet. <br> Disha, write something important!</p>
                    </div>
                `;
                return;
            }

            quickNotes.forEach(note => {
                const item = document.createElement('div');
                item.className = `flex items-center gap-3 p-4 bg-slate-50 dark:bg-slate-900 rounded-2xl transition-all ${note.done ? 'opacity-50' : ''}`;
                item.innerHTML = `
                    <button onclick="toggleNoteState(${note.id})" class="shrink-0 w-6 h-6 border-2 ${note.done ? 'vibe-bg border-vibe-color' : 'border-slate-300'} rounded-lg flex items-center justify-center transition-colors">
                        ${note.done ? '<svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg>' : ''}
                    </button>
                    <span class="text-sm font-medium flex-grow ${note.done ? 'line-through text-slate-400' : 'text-slate-700 dark:text-slate-200'}">${note.text}</span>
                    <button onclick="deleteNote(${note.id})" class="p-2 text-slate-300 hover:text-red-400 transition-colors">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-4v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                    </button>
                `;
                container.appendChild(item);
            });
        }

        function updateNotesBadge() {
            const badge = document.getElementById('notes-count-badge');
            const pendingCount = quickNotes.filter(n => !n.done).length;
            if (pendingCount > 0) {
                badge.classList.remove('hidden');
            } else {
                badge.classList.add('hidden');
            }
        }

        // --- PWA & SOUND ---
        const playSparkleSound = () => {
            try {
                const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioCtx.createOscillator();
                const gainNode = audioCtx.createGain();
                oscillator.connect(gainNode);
                gainNode.connect(audioCtx.destination);
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(880, audioCtx.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(1760, audioCtx.currentTime + 0.1);
                gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
                oscillator.start();
                oscillator.stop(audioCtx.currentTime + 0.3);
            } catch (e) { }
        };

        const setupPWA = () => {
            const manifest = {
                "name": `${USER_NAME}'s Routine Buddy`,
                "short_name": "Routine Buddy",
                "start_url": ".",
                "display": "standalone",
                "background_color": "#fdf2f8",
                "theme_color": CURRENT_VIBE_HEX,
                "icons": [{ "src": "https://fonts.gstatic.com/s/i/shortterm/release/googlestyleshelf/emoji/v1/48px/1f338.png", "sizes": "192x192", "type": "image/png" }]
            };
            const manifestBlob = new Blob([JSON.stringify(manifest)], {type: 'application/json'});
            const link = document.createElement('link'); link.rel = 'manifest'; link.href = URL.createObjectURL(manifestBlob); document.head.appendChild(link);
            const swCode = `self.addEventListener('install', (e) => self.skipWaiting()); self.addEventListener('activate', (e) => e.waitUntil(clients.claim())); self.addEventListener('fetch', (e) => {});`;
            if ('serviceWorker' in navigator) navigator.serviceWorker.register(URL.createObjectURL(new Blob([swCode], {type: 'application/javascript'}))).catch(() => {});
        };

        // --- CORE LOGIC ---
        function getTodayString() { const n = new Date(); return `${n.getFullYear()}-${n.getMonth() + 1}-${n.getDate()}`; }

        function checkDailyReset() {
            const today = getTodayString();
            const lastDate = localStorage.getItem('lastDate');
            streak = parseInt(localStorage.getItem('streak') || '0');
            const history = JSON.parse(localStorage.getItem('routineHistory') || '{}');

            if (lastDate && lastDate !== today) {
                const lastDateObj = new Date(lastDate);
                const todayDateObj = new Date(today);
                const diffTime = Math.abs(todayDateObj - lastDateObj);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

                if (diffDays > 1 || !history[lastDate] || history[lastDate] < 1) streak = 0;
                completedIds = [];
                waterCount = 0;
                localStorage.setItem('completedTasks', JSON.stringify([]));
                localStorage.setItem('waterCount', '0');
                localStorage.setItem('journal', "");
                if (document.getElementById('journal-input')) document.getElementById('journal-input').value = "";
            } else {
                completedIds = JSON.parse(localStorage.getItem('completedTasks') || '[]');
                waterCount = parseInt(localStorage.getItem('waterCount') || '0');
                if (document.getElementById('journal-input')) document.getElementById('journal-input').value = localStorage.getItem('journal') || "";
            }

            localStorage.setItem('lastDate', today);
            localStorage.setItem('streak', streak.toString());
            const badge = document.getElementById('streak-badge');
            if (badge) badge.innerText = `${streak} Days üî•`;
            
            checkSundaySummary();
            updateNotesBadge();
        }

        function checkSundaySummary() {
            const now = new Date();
            const isSunday = now.getDay() === 0;
            const container = document.getElementById('sunday-summary');
            if (!isSunday || isDemoMode) { container?.classList.add('hidden'); return; }
            
            container?.classList.remove('hidden');
            const history = JSON.parse(localStorage.getItem('routineHistory') || '{}');
            let bloomCount = 0;
            const todayStr = getTodayString();
            for(let i=0; i<7; i++) {
                const d = new Date(); d.setDate(now.getDate() - i);
                const key = `${d.getFullYear()}-${d.getMonth() + 1}-${d.getDate()}`;
                if ((key === todayStr && completedIds.length === tasks.length) || history[key] === 1) bloomCount++;
            }
            const text = document.getElementById('bloom-score-text');
            if (text) {
                if (bloomCount === 7) text.innerText = `${USER_NAME}, you were 100% consistent this week! You're a star! üåü`;
                else if (bloomCount > 0) text.innerText = `${USER_NAME}, you bloomed ${bloomCount} times this week! Keep growing! üíê`;
                else text.innerText = `A new week starts now, ${USER_NAME}! Let's make it beautiful. ‚ú®`;
            }
        }

        function toggleTask(id) {
            if (isDemoMode) return;
            const index = completedIds.indexOf(id);
            if (index > -1) completedIds.splice(index, 1);
            else { 
                completedIds.push(id); 
                showPositiveToast(); 
                playSparkleSound();
                updateBuddyMessage(true);
            }
            localStorage.setItem('completedTasks', JSON.stringify(completedIds));
            renderTasks(); 
            updateProgress();
            if (completedIds.length === tasks.length) handlePerfectDay();
        }

        function handlePerfectDay() {
            triggerConfetti();
            const today = getTodayString();
            const history = JSON.parse(localStorage.getItem('routineHistory') || '{}');
            if (!history[today] || history[today] < 1) {
                streak = (parseInt(localStorage.getItem('streak') || '0')) + 1;
                let totalPerfect = (parseInt(localStorage.getItem('totalPerfectDays') || '0')) + 1;
                localStorage.setItem('streak', streak.toString());
                localStorage.setItem('totalPerfectDays', totalPerfect.toString());
                if (document.getElementById('streak-badge')) document.getElementById('streak-badge').innerText = `${streak} Days üî•`;
            }
            history[today] = 1; 
            localStorage.setItem('routineHistory', JSON.stringify(history));
            renderChart();
            setHeader();
        }

        function updateBuddyMessage(immediate = false) {
            const bubble = document.getElementById('buddy-bubble');
            const text = document.getElementById('buddy-text');
            if (!bubble || !text) return;
            if (immediate) {
                bubble.classList.add('scale-110');
                setTimeout(() => bubble.classList.remove('scale-110'), 300);
            }
            const randMsg = buddyMessages[Math.floor(Math.random() * buddyMessages.length)];
            text.innerText = randMsg.replace("{name}", USER_NAME);
        }

        function changeVibe(name, hex) {
            CURRENT_VIBE = name;
            CURRENT_VIBE_HEX = hex;
            localStorage.setItem('currentVibe', name);
            localStorage.setItem('currentVibeHex', hex);
            applyVibe();
        }

        function applyVibe() {
            const root = document.documentElement;
            root.style.setProperty('--vibe-color', CURRENT_VIBE_HEX);
            root.style.setProperty('--vibe-light', `${CURRENT_VIBE_HEX}22`);
            const meta = document.getElementById('meta-theme-color');
            if (meta) meta.content = CURRENT_VIBE_HEX;
            document.querySelectorAll('.vibe-dot').forEach(dot => {
                dot.classList.toggle('active', dot.getAttribute('data-vibe') === CURRENT_VIBE);
            });
            renderChart();
            updateStaticText();
        }

        function updateUserNameSetting() {
            const input = document.getElementById('setting-name');
            if (input) {
                USER_NAME = input.value || "Disha";
                localStorage.setItem('userName', USER_NAME);
                updateStaticText();
            }
        }

        function switchTab(tab) {
            currentView = tab;
            isDemoMode = (tab === 'demo');
            ['view-today', 'view-about', 'view-milestones', 'view-settings'].forEach(id => document.getElementById(id)?.classList.add('hidden'));

            if (tab === 'today' || tab === 'demo') {
                document.getElementById('view-today')?.classList.remove('hidden');
                if (isDemoMode) {
                    document.getElementById('greeting').innerText = "üéÄ Demo Mode";
                    document.getElementById('current-date').innerText = "Preview Only";
                } else { setHeader(); checkSundaySummary(); }
            } else if (tab === 'about') document.getElementById('view-about')?.classList.remove('hidden');
            else if (tab === 'milestones') { document.getElementById('view-milestones')?.classList.remove('hidden'); renderMilestones(); }
            else if (tab === 'settings') { 
                document.getElementById('view-settings')?.classList.remove('hidden'); 
                const input = document.getElementById('setting-name');
                if (input) input.value = USER_NAME;
            }

            document.getElementById('demo-badge')?.classList.toggle('hidden', !isDemoMode);
            document.getElementById('bottom-bar')?.classList.toggle('hidden', tab === 'about' || tab === 'milestones' || tab === 'settings');
            
            updateStaticText();
            renderTasks();
            renderChart();
            renderWater();
            toggleSidebar();
            window.scrollTo(0,0);
        }

        function updateStaticText() {
            const sbName = document.getElementById('sidebar-name');
            if (sbName) sbName.innerText = `${USER_NAME}'s Buddy`;
            const statsTitle = document.getElementById('stats-title');
            if (statsTitle) statsTitle.innerText = `üå∏ ${USER_NAME}'s Stats`;
            const msTitle = document.getElementById('milestones-title');
            if (msTitle) msTitle.innerText = `${USER_NAME}'s Stickers üèÖ`;
            const rTitle = document.getElementById('reward-title');
            if (rTitle) rTitle.innerText = `${CURRENT_VIBE.toUpperCase()} QUEEN!`;
            const rText = document.getElementById('reward-text');
            if (rText) rText.innerText = `${USER_NAME}, you've conquered the day!`;
            const abText = document.getElementById('about-text');
            if (abText) abText.innerText = `Tell your besties about ${USER_NAME}'s Routine Buddy! üå∏`;
            const journal = document.getElementById('journal-input');
            if (journal && !isDemoMode) journal.placeholder = `What made you smile today, ${USER_NAME}?`;
            updateBuddyMessage();
        }

        function renderTasks() {
            const container = document.getElementById('task-container');
            if (!container) return;
            container.innerHTML = '';
            const activeList = isDemoMode ? demoCompletedIds : completedIds;
            tasks.forEach(task => {
                const isCompleted = activeList.includes(task.id);
                const card = document.createElement('div');
                card.className = `task-card p-5 rounded-2xl border-2 flex items-center justify-between shadow-sm transition-all ${isDemoMode ? 'read-only' : 'cursor-pointer'} ${isCompleted ? 'completed-card' : 'bg-white dark:bg-darkCard border-slate-100 dark:border-slate-800'}`;
                if (!isDemoMode) card.onclick = () => toggleTask(task.id);
                card.innerHTML = `<div class="flex items-center gap-4"><span class="text-2xl">${task.emoji}</span><div class="flex flex-col"><span class="text-lg font-bold ${isCompleted ? 'text-green-800 dark:text-green-100' : 'text-slate-700 dark:text-slate-200'} leading-tight">${task.text}</span><span class="text-[10px] font-semibold ${isCompleted ? 'text-green-600 dark:text-green-300' : 'text-slate-400'} uppercase tracking-wider">${task.time}</span></div></div><div class="heart-container"><input type="checkbox" class="checkbox" ${isCompleted ? 'checked' : ''} disabled><div class="svg-container"><svg viewBox="0 0 24 24" class="svg-outline" xmlns="http://www.w3.org/2000/svg"><path d="M17.5,1.917a6.4,6.4,0,0,0-5.5,3.3,6.4,6.4,0,0,0-5.5-3.3A6.8,6.8,0,0,0,0,8.967c0,4.547,4.786,9.513,8.8,12.88a4.974,4.974,0,0,0,6.4,0C19.214,18.48,24,13.514,24,8.967A6.8,6.8,0,0,0,17.5,1.917Zm-3.585,18.4a2.973,2.973,0,0,1-3.83,0C4.947,16.006,2,11.87,2,8.967a4.8,4.8,0,0,1,4.5-5.05,4.8,4.8,0,0,1,4.5,5.05,1,1,0,0,0,2,0,4.8,4.8,0,0,1,4.5-5.05,4.8,4.8,0,0,1,4.5,5.05C22,11.87,19.053,16.006,13.915,20.317Z"></path></svg><svg viewBox="0 0 24 24" class="svg-filled" xmlns="http://www.w3.org/2000/svg"><path d="M17.5,1.917a6.4,6.4,0,0,0-5.5,3.3,6.4,6.4,0,0,0-5.5-3.3A6.8,6.8,0,0,0,0,8.967c0,4.547,4.786,9.513,8.8,12.88a4.974,4.974,0,0,0,6.4,0C19.214,18.48,24,13.514,24,8.967A6.8,6.8,0,0,0,17.5,1.917Z"></path></svg><svg class="svg-celebrate" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><polygon points="50,10 55,20 65,20 60,30 65,40 55,40 50,50 45,40 35,40 40,30 35,20 45,20"></polygon><polygon points="20,40 25,50 35,50 30,60 35,70 25,70 20,80 15,70 5,70 10,60 5,50 15,50"></polygon><polygon points="80,40 85,50 95,50 90,60 95,70 85,70 80,80 75,70 65,70 70,60 65,50 75,50"></polygon></svg></div></div>`;
                container.appendChild(card);
            });
        }

        function updateProgress() {
            const activeList = isDemoMode ? demoCompletedIds : completedIds;
            const percentage = (activeList.length / tasks.length) * 100;
            const bar = document.getElementById('progress-bar');
            if (bar) bar.style.width = `${percentage}%`;
            const text = document.getElementById('progress-text');
            if (text) text.innerText = `${activeList.length} / ${tasks.length} tasks`;
            const circle = document.getElementById('circular-progress-bar');
            if (circle) circle.style.strokeDashoffset = (32 * 2 * Math.PI) - (percentage / 100 * (32 * 2 * Math.PI));
            const label = document.getElementById('circle-percent');
            if (label) label.innerText = `${Math.round(percentage)}%`;
            const reward = document.getElementById('perfect-day-reward');
            if (reward) reward.classList.toggle('hidden', activeList.length < tasks.length);
        }

        function setHeader() {
            const now = new Date();
            const hour = now.getHours();
            const count = completedIds.length;
            const total = tasks.length;
            const greeting = document.getElementById('greeting');
            const date = document.getElementById('current-date');
            const quote = document.getElementById('daily-quote');

            if (greeting) {
                if (count === total) greeting.innerText = `You did it, ${USER_NAME}! üëë`;
                else if (count === total - 1 && count > 0) greeting.innerText = `Almost there, ${USER_NAME}! ‚ú®`;
                else {
                    if (hour < 12) greeting.innerText = `Good Morning, ${USER_NAME}! üåû`;
                    else if (hour < 17) greeting.innerText = `Good Afternoon, ${USER_NAME}! ‚òÅÔ∏è`;
                    else greeting.innerText = `Good Evening, ${USER_NAME}! üåô`;
                }
            }
            if (date) date.innerText = now.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' });
            const dayOfYear = Math.floor((now - new Date(now.getFullYear(), 0, 0)) / (1000 * 60 * 60 * 24));
            if (quote) quote.innerText = `"${meaningfulQuotes[dayOfYear % meaningfulQuotes.length]}"`;
        }

        function renderChart() {
            const container = document.getElementById('chart-container');
            if (!container) return;
            container.innerHTML = '';
            const history = JSON.parse(localStorage.getItem('routineHistory') || '{}');
            const todayStr = getTodayString();
            const daysToShow = chartRange === 'week' ? 7 : 30;
            const isDarkMode = document.documentElement.classList.contains('dark');

            for (let i = daysToShow - 1; i >= 0; i--) {
                const date = new Date(); date.setDate(new Date().getDate() - i);
                const dateKey = `${date.getFullYear()}-${date.getMonth() + 1}-${date.getDate()}`;
                let percent = (dateKey === todayStr && !isDemoMode) ? (completedIds.length / tasks.length) : (history[dateKey] || 0);
                if (isDemoMode) percent = [0.8, 1.0, 0.4, 0.9, 0.2, 0.7, 1.0][i % 7];
                let barEmoji = percent === 0 ? "üå±" : percent < 0.5 ? "üåø" : percent < 1.0 ? "üå∏" : "üëë";
                const column = document.createElement('div');
                column.className = "flex flex-col items-center flex-1 min-w-[32px] h-full";
                column.innerHTML = `<span class="text-xs mb-1 shrink-0">${barEmoji}</span><div class="w-3.5 rounded-full ${isDarkMode ? 'bg-slate-800' : 'bg-slate-100'} flex-grow relative overflow-hidden flex flex-col justify-end"><div class="pipe-bar w-full vibe-bg rounded-full" style="height: ${Math.round(percent * 100)}%"></div></div><span class="text-[9px] mt-2 font-bold ${dateKey === todayStr ? 'vibe-text' : 'text-slate-300 dark:text-slate-600'}">${date.getDate()}</span>`;
                container.appendChild(column);
            }
            if (chartRange === 'month') setTimeout(() => container.scrollLeft = container.scrollWidth, 50);
        }

        function renderMilestones() {
            const grid = document.getElementById('milestone-grid');
            if (!grid) return;
            grid.innerHTML = '';
            const total = parseInt(localStorage.getItem('totalPerfectDays') || '0');
            milestones.forEach(m => {
                const unlocked = total >= m.req;
                const card = document.createElement('div');
                card.className = `p-6 rounded-3xl border-2 flex flex-col items-center text-center transition-all ${unlocked ? 'bg-white dark:bg-darkCard border-pink-100 dark:border-pink-900/40 shadow-sm' : 'bg-slate-50 dark:bg-slate-900/50 border-transparent grayscale opacity-50'}`;
                card.innerHTML = `<span class="text-5xl mb-4">${m.emoji}</span><h3 class="font-bold text-sm text-slate-700 dark:text-slate-200">${m.text}</h3><p class="text-[10px] text-slate-400 mt-1">${unlocked ? 'Unlocked!' : `${total}/${m.req}`}</p>`;
                grid.appendChild(card);
            });
        }

        function renderWater() {
            const container = document.getElementById('water-droplets');
            if (!container) return;
            container.innerHTML = '';
            const activeCount = isDemoMode ? 5 : waterCount;
            const textLabel = document.getElementById('water-count');
            if (textLabel) textLabel.innerText = `${activeCount}/8 Cups`;
            for (let i = 0; i < 8; i++) {
                const droplet = document.createElement('div');
                droplet.className = `droplet w-8 h-8 rounded-full border-2 flex items-center justify-center text-sm cursor-pointer ${i < activeCount ? 'bg-blue-400 border-blue-500 shadow-sm' : 'border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900'}`;
                droplet.innerHTML = i < activeCount ? 'üíß' : '‚ö™Ô∏è';
                droplet.onclick = () => { if (!isDemoMode) { waterCount = (i + 1 === waterCount) ? waterCount - 1 : i + 1; localStorage.setItem('waterCount', waterCount.toString()); renderWater(); showPositiveToast(); } };
                container.appendChild(droplet);
            }
        }

        function saveJournal() { if (!isDemoMode) localStorage.setItem('journal', document.getElementById('journal-input').value); }
        function showPositiveToast() {
            const container = document.getElementById('toast-container');
            if (!container) return;
            const toast = document.createElement('div');
            toast.className = "floating-message bg-white dark:bg-slate-800 vibe-text px-6 py-3 rounded-full shadow-xl border border-slate-100 dark:border-slate-700 font-bold mb-4 text-xs";
            toast.innerText = motivationalQuotes[Math.floor(Math.random() * motivationalQuotes.length)];
            container.appendChild(toast);
            setTimeout(() => toast.remove(), 2000);
        }
        function copyAppShare() { navigator.clipboard.writeText(`Hey! Check out ${USER_NAME}'s Routine Buddy! üå∏‚ú®`).then(() => showPositiveToast()); }
        function setChartRange(r) { chartRange = r; renderChart(); }
        function toggleSidebar() { document.getElementById('sidebar')?.classList.toggle('closed'); document.getElementById('sidebar-overlay')?.classList.toggle('hidden'); }
        function toggleTheme() { const isDark = document.documentElement.classList.toggle('dark'); localStorage.setItem('theme', isDark ? 'dark' : 'light'); document.getElementById('toggle-knob').innerText = isDark ? 'üåô' : 'üåû'; renderChart(); }
        function initTheme() { const saved = localStorage.getItem('theme'); if (saved === 'dark' || (!saved && window.matchMedia('(prefers-color-scheme: dark)').matches)) { document.documentElement.classList.add('dark'); document.getElementById('toggle-knob').innerText = 'üåô'; } }

        window.onload = () => { setupPWA(); initTheme(); applyVibe(); checkDailyReset(); updateStaticText(); setHeader(); renderTasks(); renderChart(); renderWater(); updateProgress(); };
        document.addEventListener('visibilitychange', () => { if (document.visibilityState === 'visible') { checkDailyReset(); if (!isDemoMode) setHeader(); renderTasks(); renderChart(); renderWater(); updateProgress(); } });
    </script>
</body>
</html>